@implements IAsyncDisposable
@inject DetectThemeHelper DetectThemeHelper

<ThemeProvider
    Theme="@Theme" />

@code
{
    private Theme Theme { set; get; } = Theme.Light;

    private IDisposable TimeoutDisposal { set; get; }

    protected override Task OnInitializedAsync()
    {
        DetectThemeHelper.OnChange += OnThemeChanged;

        TimeoutDisposal = ExecutionPlan.Delay(500, () => {
            _ = DetectThemeHelper.InitAsync();
        });

        return Task.CompletedTask;
    }

    protected void OnThemeChanged(object sender, Theme theme)
    {
        Theme = theme;

        _ = InvokeAsync(StateHasChanged);
    }

    public ValueTask DisposeAsync()
    {
        TimeoutDisposal?.Dispose();

        DetectThemeHelper.OnChange -= OnThemeChanged;

        return DetectThemeHelper.DisposeAsync();
    }
}